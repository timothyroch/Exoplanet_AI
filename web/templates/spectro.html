<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spectrometry Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&display=swap" rel="stylesheet" />
    <style>
      body {
        font-family: "Quicksand", sans-serif;
        background-image: url("{{ url_for('static', path='planet.jpg') }}");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }
      .form-container { background-color: rgba(255,255,255,0.7); backdrop-filter: blur(10px); }
      .result-container { background-color: rgba(255,255,255,0.8); backdrop-filter: blur(10px); }
    </style>
  </head>
  <body class="bg-pink-100 text-gray-800 p-8">
    <div class="max-w-7xl mx-auto">
      <header class="mb-12">
        <h1 class="text-5xl font-bold mb-2 text-blue-500">Spectrometry Analysis</h1>
        <p class="text-lg text-gray-600">Upload a CSV with the Macedo/Zalewski features for batch predictions.</p>
        <p class="mt-2"><a href="/" class="text-blue-600 underline">← Back to Exoplanet (KOI) page</a></p>
      </header>

      {% if spectro_error %}
      <div class="mb-6 rounded-lg bg-red-50 border border-red-200 text-red-800 p-4">
        {{ spectro_error }}
      </div>
      {% endif %}

      <!-- Upload only -->
      <div class="mt-8 p-8 form-container rounded-2xl shadow-lg border border-white">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Upload Spectrometry CSV</h2>
        <p class="mb-4 text-gray-600">
          Use the same columns the model was trained on. We’ll coerce numerics, handle NaNs, and predict for each row.
          {% if spectro_sample_available %}
          <a href="/spectro/sample-csv" class="text-blue-600 underline">Download sample CSV header</a>
          {% endif %}
        </p>
        <form action="/spectro/upload" method="post" enctype="multipart/form-data" class="flex flex-col items-center space-y-4">
          <input
            type="file"
            name="file"
            accept=".csv"
            required
            class="block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-blue-700 hover:file:bg-blue-100"
          />
          <button
            type="submit"
            class="bg-blue-500 text-white py-2 px-6 rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 text-lg font-bold transition-all duration-300 ease-in-out"
          >
            Upload and Predict
          </button>
        </form>
      </div>

      {% if spectro_batch %}
      <div class="mt-8 p-8 result-container rounded-2xl shadow-lg border border-white">
        <h2 class="text-2xl font-bold mb-4 text-blue-600">Batch Predictions</h2>
        <p class="mb-2 text-gray-700">Processed <strong>{{ spectro_batch.rows }}</strong> rows.</p>
        <p class="mb-6">
          <a class="inline-block text-white bg-blue-500 hover:bg-blue-600 rounded px-4 py-2"
             href="{{ spectro_batch.download_href }}" download>
            Download CSV
          </a>
        </p>
        <div class="bg-white rounded shadow p-4 overflow-auto">
          {{ spectro_batch.preview_html | safe }}
        </div>
      </div>
      {% endif %}
    </div>
  </body>
</html>
