<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exoplanet Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Quicksand", sans-serif;
        background-image: url("{{ url_for('static', path='planet.jpg') }}"); 
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }
      .form-container {
        background-color: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
      }
      .result-container {
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
      }
    </style>
  </head>
  <body class="bg-pink-100 text-gray-800 p-8">
    <div class="max-w-7xl mx-auto relative">
      <div class="absolute top-0 right-0 mt-6 mr-6 z-10">
        <a href="/info" class="inline-block bg-blue-500 text-white py-2 px-6 rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 text-lg font-bold transition-all duration-300 ease-in-out shadow-lg">
          More Information
        </a>
      </div>
      <header class="mb-12">
        <h1 class="text-5xl font-bold mb-2 text-blue-500">
          Exoplanet Prediction
        </h1>
        <p class="text-lg text-gray-600">
          Enter personalized enteries for Kepler Object of Interest (KOI) features to predict if they're Exoplanet.
        </p>
      </header>

      <form
        action="/"
        method="post"
        class="form-container p-8 rounded-2xl shadow-lg border border-white"
      >
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-8"
        >
          {% for feature, info in feature_info.items() %}
          <div class="flex flex-col">
            {% if info.type == 'checkbox' %}
            <label for="{{ feature }}" class="font-semibold mb-2 text-gray-700"
              >{{ info.label }}</label
            >
            <div>
              <input type="checkbox" id="{{ feature }}" name="{{ feature }}"
              value="1" class="hidden bool-checkbox" {% if user_input and
              user_input[feature] == 1 %}checked{% endif %} />
              <button
                type="button"
                data-target="{{ feature }}"
                class="bool-toggle w-full rounded-md border-2 border-pink-500 text-pink-500 px-2 py-2 font-semibold cursor-pointer transition-colors duration-200 select-none focus:outline-none focus:ring-2 focus:ring-pink-400"
                aria-pressed="false"
              >
                False
              </button>
            </div>
            {% else %}
            <label for="{{ feature }}" class="font-semibold mb-2 text-gray-700"
              >{{ info.label }}</label
            >
            <input
              type="number"
              step="any"
              min="{{ info.min }}"
              max="{{ info.max }}"
              id="{{ feature }}"
              name="{{ feature }}"
              value="{{ user_input[feature] if user_input else info.default }}"
              required
              class="p-2 bg-white border border-pink-200 text-gray-800 rounded-md shadow-sm focus:ring-2 focus:ring-pink-400 focus:border-pink-400 transition"
            />
            {% endif %}
          </div>
          {% endfor %}
        </div>
        <div class="text-center">
          <button
            type="submit"
            class="mt-10 bg-blue-500 text-white py-3 px-8 rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 text-xl font-bold transition-all duration-300 ease-in-out"
          >
            Predict
          </button>
        </div>
      </form>

      {% if prediction %}
      <div
        class="mt-12 p-8 result-container rounded-2xl shadow-lg border border-white"
      >
        <div class="text-center text-2xl space-y-4">
          <p>
            <strong class="font-bold text-gray-600">Prediction:</strong>
            <span class="font-bold text-blue-500">{{ prediction }}</span>
          </p>
          <p>
            <strong class="font-bold text-gray-600">Confidence:</strong>
            <span class="font-bold text-blue-500">{{ confidence }}</span>
          </p>
        </div>
      </div>
      {% endif %}
      <hr class="my-12 border-pink-300" />

<div class="mt-8 p-8 form-container rounded-2xl shadow-lg border border-white">
  <h2 class="text-2xl font-bold mb-4 text-blue-600">Upload Data File</h2>
  <p class="mb-4 text-gray-600">
    Upload a CSV or JSON file containing your KOI features. The model will
    generate predictions for each entry.
  </p>

  <form
    action="/upload"
    method="post"
    enctype="multipart/form-data"
    class="flex flex-col items-center space-y-4"
  >
    <input
      type="file"
      name="file"
      accept=".csv,.json"
      required
      class="block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-blue-700 hover:file:bg-blue-100"
    />
    <button
      type="submit"
      class="bg-blue-500 text-white py-2 px-6 rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 text-lg font-bold transition-all duration-300 ease-in-out"
    >
      Upload and Predict
    </button>
  </form>
</div>
{% if batch %}
<div class="mt-8 p-8 result-container rounded-2xl shadow-lg border border-white">
  <h2 class="text-2xl font-bold mb-4 text-blue-600">Batch Predictions</h2>
  <p class="mb-2 text-gray-700">
    Processed <strong>{{ batch.rows }}</strong> rows.
  </p>
  <p class="mb-6">
    <a class="inline-block text-white bg-blue-500 hover:bg-blue-600 rounded px-4 py-2"
       href="{{ batch.download_href }}" download>
      Download CSV
    </a>
  </p>
  <div class="bg-white rounded shadow p-4 overflow-auto">
    {{ batch.preview_html | safe }}
  </div>
</div>
{% endif %}

<!-- Spectrometry Uploader -->

<div class="mt-12 p-8 form-container rounded-2xl shadow-lg border border-white">
  <h2 class="text-2xl font-bold mb-4 text-blue-600">Upload Spectrometry Data</h2>
  <p class="mb-4 text-gray-600">
    Upload a <strong>spectrometry CSV file</strong> (Macedo/Zalewski format). The model will clean and predict based on your spectral features.
  </p>

  <form
    action="/spectro/upload"
    method="post"
    enctype="multipart/form-data"
    class="flex flex-col items-center space-y-4"
  >
    <input
      type="file"
      name="file"
      accept=".csv"
      required
      class="block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-50 file:text-blue-700 hover:file:bg-blue-100"
    />
    <button
      type="submit"
      class="bg-blue-500 text-white py-2 px-6 rounded-full hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 text-lg font-bold transition-all duration-300 ease-in-out"
    >
      Upload and Predict (Spectrometry)
    </button>
  </form>
</div>
{% if spectro_error %}
<div class="mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
  {{ spectro_error }}
</div>
{% endif %}
 {% if spectro_batch %}
<div class="mt-8 p-8 result-container rounded-2xl shadow-lg border border-white">
  <h2 class="text-2xl font-bold mb-4 text-blue-600">Spectrometry Predictions</h2>
  <p class="mb-2 text-gray-700">
    Processed <strong>{{ spectro_batch.rows }}</strong> rows.
  </p>
  <p class="mb-6">
    <a class="inline-block text-white bg-blue-500 hover:bg-blue-600 rounded px-4 py-2"
       href="{{ spectro_batch.download_href }}" download>
      Download CSV
    </a>
  </p>
  <div class="bg-white rounded shadow p-4 overflow-auto">
    {{ spectro_batch.preview_html | safe }}
  </div>
</div>
{% endif %}


    </div>
  </body>
  <script>
    // Initialize and wire up JS-based boolean toggles
    function syncToggle(btn, checkbox) {
      const isChecked = checkbox.checked;
      btn.textContent = isChecked ? "True" : "False";
      btn.setAttribute("aria-pressed", String(isChecked));
      if (isChecked) {
        btn.classList.add("bg-blue-500", "text-white");
        btn.classList.remove("text-blue-500");
      } else {
        btn.classList.remove("bg-blue-500", "text-white");
        btn.classList.add("text-blue-500");
      }
    }

    document.querySelectorAll(".bool-toggle").forEach((btn) => {
      const targetId = btn.getAttribute("data-target");
      const checkbox = document.getElementById(targetId);
      if (!checkbox) return;
      // Initial state
      syncToggle(btn, checkbox);
      // Click handler
      btn.addEventListener("click", () => {
        checkbox.checked = !checkbox.checked;
        syncToggle(btn, checkbox);
      });
      // Keyboard accessibility (space/enter if focused)
      btn.addEventListener("keydown", (e) => {
        if (e.key === " " || e.key === "Enter") {
          e.preventDefault();
          checkbox.checked = !checkbox.checked;
          syncToggle(btn, checkbox);
        }
      });
    });

  </script>
</html>
